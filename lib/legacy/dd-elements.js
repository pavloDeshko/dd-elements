"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}module.exports={element:element,e:element,wrap:wrap};var createElement=require("react").createElement;function element(a,b){var c=draft(a),d=new Collection([c],c);return b&&d.datum(b),d}var Collection=/*#__PURE__*/function(){function a(b,c,d){var e=this;_classCallCheck(this,a),this._elems=b||[],this._root=c,this._parents=[],b.forEach(function(a){return e._parents.includes(a.parent)?"_":e._parents.push(a.parent)}),this._otherElems=d||[]}return _createClass(a,[{key:"_offspring",value:function _offspring(b){return new a(b,this._root)}},{key:"_evl",value:function _evl(a,b,c){return"function"==typeof a?a(b.datum,c,this._offspring([b])):a}},{key:"parents",value:function parents(){return this._offspring(this._parents)}},{key:"size",value:function size(){return this._elems.length}},{key:"merge",value:function merge(a){return this._offspring(combine(this._elems,a._elems))}},{key:"sort",value:function sort(c){var d,e=this,f=Array(this._parents.length).fill([]),g=Array(this._parents.length).fill([]),h=[];return this._elems.forEach(function(a){var b=e._parents.indexOf(a.parent);f[b].push(a),g[b].push(a.parent.children.indexOf(a))}),g.forEach(function(a){return a.sort()}),f.forEach(function(a,b){h[b]=a.slice().sort(c?function(d,a){return c(d.datum,a.datum,e._offspring([d]),e._offspring([a]))}:function(c,a){return c.datum>a.datum?1:c.datum<a.datum?-1:0})}),h.forEach(function(a,b){a.forEach(function(a,c){var d=g[b][c];e._parents[b].children[d]=a})}),this._offspring((d=[]).concat.apply(d,h))}},{key:"filter",value:function filter(b){var c=this,d=[],e=[];return this._elems.forEach(function(a,f){b(a.datum,f,c._offspring([a]))?d.push(a):e.push(a)}),new a(d,this._root,e)}},{key:"other",value:function other(){return this._offspring(this._otherElems)}},{key:"all",value:function all(){return toReact(this._root)}},{key:"child",value:function child(a,b){return this._append(a,b,!1)}},{key:"children",value:function children(a,b){return 0==arguments.length?this._offspring(this._elems.reduce(function(a,b){return a.concat(b.children.filter(function(a){return"string"!=typeof a}))}//filtering text (non-draft) nodes
,[])):this._append(a,b,!0)}},{key:"append",value:function append(a,b){return this._append(a,b,void 0)}},{key:"_append",value:function _append(a,b,c){var d=this,e=[];return this._elems.forEach(function(f,g){var h=d._evl(b,f,g);if(c&&!Array.isArray(h))throw new Error("Second argument to selection.children() must be an array");else!1===c?h=[h]:void 0!==c||Array.isArray(h)||(h=[h]);h.forEach(function(b){var c=draft(a,f);c.datum=b?d._evl(b,f,g):f.datum,f.children.push(c),e.push(c)})}),this._offspring(e)}},{key:"datum",value:function datum(a){var b=this;return void 0===a?this._elems[0]?this._elems[0].datum:void 0:(this._elems.forEach(function(c,d){c.datum=b._evl(a,c,d)}),this)}},{key:"type",value:function type(a){var b=this;return void 0===a?this._elems[0]?this._elems[0].type:void 0:(this._elems.forEach(function(c,d){return c.type=b._evl(a,c,d)}),this)}},{key:"attr",value:function attr(a,b){var c=this;return void 0===b?this._elems[0]?this._elems[0].props[a]:void 0:(this._elems.forEach(function(d,e){return d.props[a]=c._evl(b,d,e)}),this)}},{key:"prop",value:function prop(){return this.attr.apply(this,arguments)}},{key:"props",value:function props(a){for(var b in a)this.attr(b,a[b]);return this}},{key:"classed",value:function classed(a){var b=this,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this._elems.forEach(function(d,e){var f=b._evl(a,d,e).split(" "),g=d.props.className.split(" ");f.forEach(function(a){var f=b._evl(c,d,e),h=g.indexOf(a);-1==h&&f&&g.push(a),-1==h||f||g.splice(h,1)}),d.props.className=g.join(" ")}),this}},{key:"isClassed",value:function isClassed(a){if(0==this.elem.length)return!1;var b=!0;return this._elems[0].props.className.split(" "),a.split(" ").forEach(function(a){classes.includes(a)||(b=!1)}),b}},{key:"style",value:function style(a,b){var c=this;return void 0===b?this._elems[0]?this._elems[0].props.style[a]:void 0:(this._elems.forEach(function(d,e){return d.props.style[a]=c._evl(b,d,e)}),this)}},{key:"text",value:function text(a){var b=this;return this._elems.forEach(function(c,d){return c.children.push(b._evl(a,c,d))}),this}}]),a}();function draft(a,b){return{type:a,props:{style:{},className:""},children:[],parent:b||null,datum:null}}function toReact(a){return a?"string"==typeof a?a:createElement(a.type,a.props,a.children.map(toReact)):void 0}function combine(a,b){var c=a.slice();return b.forEach(function(b){return a.includes(b)?null:c.push(b)}),c}function wrap(a,b){return function(c){return a(c,b?element:void 0).all()}}